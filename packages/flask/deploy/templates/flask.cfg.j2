
flask {
  # dont set this for automted deployment as it will then be used
  # for the 'cluster' of the local flask collecting metrics about itself.
  # by not specifiying this, the process reads the network address and
  # uses that instead.
  # name = "flask"

  metric-ttl = 24 hours

  collect-local-metrics = true

  local-metric-frequency = 30

  environment = "{{ application_environment }}"

  network {
    host = "127.0.0.1"
    http-port = 5775
    telemetry-port = 7390
    selfie-port = 7557
  }

  retry-schedule {
    duration = 30s
    retries = 6
  }

  elastic-search-exploded {
{% if application_environment == 'improd' %}
    url = "http://improd-ops-es.svc.oncue.com:9200"
{% elif application_environment == 'imqa' %}
    url = "http://imqa-ops-es.svc.oncue.com:9200"
{% else %}
    url = "http://imdev-ops-es.svc.oncue.com:9200"
{% endif %}
    index-name = "funnel"
    type-name = "metric"
    partition-date-format = "yyyy.ww"
    connection-timeout-in-ms = 3000
    minimum-publish-frequency = 10 minutes
    groups = [ "previous/jvm", "previous/system", "previous", "now" ]
    template {
      name = "flask"
      location = "/usr/share/oncue/etc/exploded-template.json"
    }
  }

  elastic-search-flattened {
{% if application_environment == 'improd' %}
    url = "http://improd-ops-es.svc.oncue.com:9200"
{% elif application_environment == 'imqa' %}
    url = "http://imqa-ops-es.svc.oncue.com:9200"
{% else %}
    url = "http://imdev-ops-es.svc.oncue.com:9200"
{% endif %}
    index-name = "monitoring"
    type-name = "metric"
    partition-date-format = "yyyy.MM.dd"
    connection-timeout-in-ms = 3000
    minimum-publish-frequency = 10 minutes
    groups = [ "previous", "now" ]
    template {
      name = "flask"
      location = "/usr/share/oncue/etc/flattened-template.json"
    }
  }
}
